<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<div *ngIf="!currentInstitution" class="loadscreen">
    <img src="assets/images/logo.png" class="logo mb-3" style="display: none" alt="">
    <div class="loader-bubble loader-bubble-primary d-block"></div>
</div>
<div *ngIf="currentInstitution"  class="card user-profile o-hidden mb-4">
    <div class="header-cover" style="background-image: url('assets/images/photo-wide-4.jpg')"></div>
    <div class="user-info">
        <img class="profile-picture avatar-lg mb-2" [src]="imageSrc || 'assets/default-university-image.jpg' " alt="">
        <p class="m-0 text-24">{{currentInstitution?.name}} </p>
        <p class="text-muted m-0">{{currentInstitution?.slogan||""}}</p>
    </div>
    <div class="card-body">
        <ngb-tabset (tabChange)="onTabChange($event)" class="nav-center">
            <ngb-tab title="About">
                <ng-template ngbTabContent>
                    <h4>Information</h4>
                    <p>{{ currentInstitution?.description || "No description available" }}</p>
                    <hr>
                    <div class="row">
                        <div class="col-md-4 col-6" *ngIf="currentInstitution?.country">
                            <p class="text-primary mb-1"><i class="i-Globe text-16 mr-1"></i> Country</p>
                            <span>{{ currentInstitution?.country }}</span>
                        </div>
                        <div class="col-md-4 col-6" *ngIf="currentInstitution?.address">
                            <p class="text-primary mb-1"><i class="i-University1 text-16 mr-1"></i> Address</p>
                            <span>{{ currentInstitution?.address }}</span>
                        </div>
                        <div class="col-md-4 col-6" *ngIf="currentInstitution?.website">
                            <p class="text-primary mb-1"><i class="i-Cloud-Weather text-16 mr-1"></i> Website</p>
                            <a href="{{currentInstitution?.website}}" target="_blank">{{currentInstitution?.website}}</a>
                        </div>
                    </div>
                </ng-template>
            </ngb-tab>
            <ngb-tab title="Map" id="mapTab">
                <ng-template ngbTabContent>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div id="map"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </ngb-tab>
            <ngb-tab *ngIf="currentInstitution.hasCalendar" title="Calendar" >
                <ng-template ngbTabContent>
                    <div class="d-flex justify-content-center mt-4">
                        <button type="button" (click)="downloadExcel()" class="btn btn-info btn-lg">
                            <i class="i-Download mr-2"></i> Download Calendar
                        </button>
                    </div>
                </ng-template>
            </ngb-tab>
            <ngb-tab *ngIf="currentUser.roles.includes('ADMIN')" title="Tools"  id="tools" >
                <ng-template ngbTabContent>
                    <div *ngIf="currentUser.roles.includes('ADMIN')"  class="d-flex justify-content-center">
                        <button type="button" (click)="addCourseModel(createCourse)" class="btn btn-success"><i class="i-Add"></i> Create Course</button>
                    </div>
                </ng-template>
            </ngb-tab>
        </ngb-tabset>
    </div>

</div>
<ng-template #createCourse let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title-user">Create Course</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="createCourseForm" (ngSubmit)="addCourse()">
            <div class="row">
                <div class="col-md-6 form-group mb-3">
                    <label for="name">Name</label>
                    <input type="text" formControlName="name" class="form-control" id="name" placeholder="Course name">
                    <div *ngIf="shouldShowError('name', 'required')" class="text-danger">
                        Name is required.
                    </div>
                    <div *ngIf="shouldShowError('name', 'maxlength')" class="text-danger">
                        Name must be less than 50 characters.
                    </div>
                    <div *ngIf="shouldShowError('name', 'minlength')" class="text-danger">
                        Name must be more than 3 characters.
                    </div>
                </div>

                <div class="col-md-6 form-group mb-3">
                    <label for="description">description</label>
                    <textarea type="text" formControlName="description" class="form-control" id="description" placeholder="Course description"></textarea>
                    <div *ngIf="shouldShowError('description', 'required')" class="text-danger">
                        Description is required.
                    </div>
                    <div *ngIf="shouldShowError('description', 'maxlength')" class="text-danger">
                        Description must be less than 100 characters.
                    </div>
                    <div *ngIf="shouldShowError('description', 'minlength')" class="text-danger">
                        Description must be more than 3 characters.
                    </div>
                </div>
                <div class="col-md-6 form-group mb-3">
                    <label for="credit">credit</label>
                    <input type="number" formControlName="credit" class="form-control" id="credit" placeholder="Course credit">
                    <div *ngIf="shouldShowError('credit', 'required')" class="text-danger">
                        Credit is required.
                    </div>
                </div>
                <div class="col-md-6 form-group mb-3">
                    <label for="groups">Classes</label>
                    <select formControlName="group" class="form-control" id="groups" data-live-search="true">
                        <option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</option>
                    </select>
                    <div *ngIf="shouldShowError('groups', 'required')" class="text-danger">
                        At least one class is required.
                    </div>
                </div>
                <div class="col-md-6 form-group mb-3">
                    <label for="teachers">Teachers</label>
                    <select formControlName="teacher" class="form-control" id="teachers" data-live-search="true">
                        <option *ngFor="let teacher of teachers" [value]="teacher">{{ teacher }}</option>
                    </select>
                    <div *ngIf="shouldShowError('teacher', 'required')" class="text-danger">
                        At least one teacher is required.
                    </div>
                </div>
                <div class="col-md-12">
                    <btn-loading btnClass="btn-primary btn-rounded" [loading]="loading">Create</btn-loading>
                </div>
            </div>
        </form>
    </div>
</ng-template>