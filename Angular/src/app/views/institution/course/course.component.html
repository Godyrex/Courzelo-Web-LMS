<div *ngIf="!course" class="loadscreen">
    <img src="assets/images/logo.png" class="logo mb-3" style="display: none" alt="">
    <div class="loader-bubble loader-bubble-primary d-block"></div>
</div>
<div *ngIf="course" class="container-fluid rounded bg-primary text-white p-4">
    <div class="row">
        <div  class="col-lg-6">
            <h1 class="display-4">{{this.course.name || "Course name" }}</h1>
            <p class="lead">{{this.course.description || "Course description" }}</p>
            <p>Credits: {{this.course.credit || 0}}</p>
        </div>
        <div class="col">
            <div class="row mt-5">
                <div class="col-lg-8 user-profile mb-4">
                    <div class="user-info">
                    <img class="profile-picture avatar-lg mb-2" [src]="imageSrc || 'assets/default-image.jpg' " alt="">
                        <h1 class="m-0" >Oussema Ouakad</h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="row mt-5">
                <div class="col-lg-8 user-profile mb-4">
                    <div class="user-info">
                        <img class="profile-picture avatar-lg mb-2" [src]="imageSrc || 'assets/default-image.jpg' " alt="">
                        <h1 class="m-0" >Oussema Ouakad</h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="row mt-5">
                <div class="col-lg-8 user-profile mb-4">
                    <div class="user-info">
                        <img class="profile-picture avatar-lg mb-2" [src]="imageSrc || 'assets/default-image.jpg' " alt="">
                        <h1 class="m-0" >Oussema Ouakad</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Buttons Section -->
<div *ngIf="course" class="container mt-3">
    <div class="d-flex justify-content-end mb-3">
        <button class="btn btn-success mr-2" *ngIf="isUserTeacherInCourse()" >Add Post</button>
        <button class="btn btn-warning mr-2" (click)="updateCourseModel(ModalUpdateCourse)"  *ngIf="isUserTeacherInCourse()" >Edit Course</button>
        <button class="btn btn-danger mr-2" *ngIf="isUserTeacherInCourse()" (click)="deleteCourse(modalConfirmCourse)">Delete Course</button>
        <button class="btn btn-secondary" *ngIf="user.roles == ['STUDENT'] || (isUserTeacherInCourse() && course.teacher.length > 1)" (click)="leaveCourse(modalConfirmLeaveCourse)">Leave Course</button>
    </div>
</div>

<!-- Main Content Section -->
<div *ngIf="course" class="container mt-3">
    <div class="row">
        <!-- Left Sidebar -->
        <div class="col-md-2">
            <!-- Placeholder for future content -->
        </div>

        <!-- Posts Section -->
        <div class="col-md-8">
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Post Title 1</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">Post Description: This is a brief description of the first post.</p>
                    <a href="#" class="btn btn-link">Download File 1</a>
                    <a href="#" class="btn btn-link">Download File 2</a>
                </div>
                <div class="card-footer">
                    <button class="btn btn-info mr-2">Edit Post</button>
                    <button class="btn btn-danger">Delete Post</button>
                </div>
            </div>
            <div class="post card mb-3">
                <div class="card-body">
                    <h2 class="card-title">Post Title: Week 1 - Introduction</h2>
                    <p class="card-text">Description: Overview of the course and introduction to programming concepts.</p>
                    <p class="card-text">Files: <a href="#">intro.pdf</a>, <a href="#">syllabus.pdf</a></p>
                    <button class="btn btn-primary">Edit Post</button>
                    <button class="btn btn-danger">Delete Post</button>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="col-md-2">
            <!-- Placeholder for future content -->
        </div>
    </div>
</div>
<ng-template #modalConfirmCourse let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-title-course">Course Deletion</h4>
        <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p><strong>Are you sure you want to delete the course <span class="text-primary">{{ course.name }}</span>?</strong></p>
        <p>All information associated with this course will be permanently deleted.
            <span class="text-danger">This operation cannot be undone.</span>
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-rounded" (click)="modal.dismiss('cancel')">Cancel</button>
        <button type="button" ngbAutofocus class="btn btn-danger btn-rounded" (click)="modal.close('Ok')">Ok</button>
    </div>
</ng-template>
<ng-template #modalConfirmLeaveCourse let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-title-course-leave">Leave Course</h4>
        <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p><strong>Are you sure you want to leave the course <span class="text-primary">{{ course.name }}</span>?</strong></p>
        <p>You will no longer have access to this course.
            <span class="text-danger">This operation cannot be undone.</span>
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-rounded" (click)="modal.dismiss('cancel')">Cancel</button>
        <button type="button" ngbAutofocus class="btn btn-danger btn-rounded" (click)="modal.close('Ok')">Ok</button>
    </div>
</ng-template>
<ng-template #ModalUpdateCourse let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title-user">Update Course</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="updateCourseForm" (ngSubmit)="updateCourse()">
            <div class="row">
                <div class="col-md-6 form-group mb-3">
                    <label for="name">Name</label>
                    <input type="text" formControlName="name" class="form-control" id="name" placeholder="Course name">
                    <div *ngIf="shouldShowError('name', 'required')" class="text-danger">
                        Name is required.
                    </div>
                    <div *ngIf="shouldShowError('name', 'maxlength')" class="text-danger">
                        Name must be less than 50 characters.
                    </div>
                    <div *ngIf="shouldShowError('name', 'minlength')" class="text-danger">
                        Name must be more than 3 characters.
                    </div>
                </div>

                <div class="col-md-6 form-group mb-3">
                    <label for="description">description</label>
                    <textarea type="text" formControlName="description" class="form-control" id="description" placeholder="Course description"></textarea>
                    <div *ngIf="shouldShowError('description', 'required')" class="text-danger">
                        Description is required.
                    </div>
                    <div *ngIf="shouldShowError('description', 'maxlength')" class="text-danger">
                        Description must be less than 100 characters.
                    </div>
                    <div *ngIf="shouldShowError('description', 'minlength')" class="text-danger">
                        Description must be more than 3 characters.
                    </div>
                </div>
                <div class="col-md-6 form-group mb-3">
                    <label for="credit">credit</label>
                    <input type="number" formControlName="credit" class="form-control" id="credit" placeholder="Course credit">
                    <div *ngIf="shouldShowError('credit', 'required')" class="text-danger">
                        Credit is required.
                    </div>
                </div>
                <div class="col-md-12">
                    <btn-loading btnClass="btn-primary btn-rounded" [loading]="loading">update</btn-loading>
                </div>
            </div>
        </form>
    </div>
</ng-template>